Bootstrap: docker
From: rocker/r-ver:4.5.2

%labels
    Maintainer Can Demircan
    Version 1.0
    Description Singularity container for running R scripts with mlogit, lme4, and tidyverse.

%files
    renv.lock /project/renv.lock
    bin/setup.R /project/bin/setup.R

%post
    # Update and install system dependencies
    apt-get update && apt-get install -y \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev \
        libfontconfig1-dev \
        libfreetype6-dev \
        libfribidi-dev \
        libharfbuzz-dev \
        libjpeg-dev \
        libpng-dev \
        libtiff-dev \
        zlib1g-dev \
        pandoc \
        cmake \
        git \
        libglpk-dev \
        libgmp3-dev \
        libnlopt-dev \
        locales

    # Configure locales
    echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
    locale-gen en_US.UTF-8
    update-locale LANG=en_US.UTF-8

    # Install renv and restore packages
    # We install system-wide to ensure all users can use them
    install2.r --error --skipinstalled \
        renv \
        mlogit \
        tidyverse \
        jsonlite \
        lme4 \
        Matrix \
        MASS \
        boot \
        lattice \
        nlme

    # Optionally, if you want exact versions from renv.lock:
    # cd /project
    # Rscript -e "renv::restore(confirm = FALSE)"

%environment
    export LC_ALL=en_US.UTF-8
    export LANG=en_US.UTF-8

%runscript
    exec Rscript "$@"
